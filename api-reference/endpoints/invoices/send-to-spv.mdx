---
title: 'Send to SPV'
api: 'POST /invoices/{id}/send-to-spv'
description: 'Send invoice to Romanian SPV (e-Factura) system'
---

## Description

Submits a fiscal invoice to the Romanian SPV (Sistem de Preluare și Validare) e-Factura system via ANAF. This endpoint handles the complete submission process including validation, XML generation, and transmission to ANAF's servers.

<Note>
  **OAuth Required**: Your account must have valid ANAF OAuth authentication configured for the target environment before using this endpoint.
</Note>

## Request

<ParamField path="id" type="string" required>
  The invoice ID to send to SPV
</ParamField>

<ParamField query="environment" type="string">
  The ANAF environment to use for submission
  
  Options:
  - `test` - Test/sandbox environment for development
  - `live` - Production environment for real invoices
  
  If not specified, uses the firm's default e-Factura environment setting.
</ParamField>

## Requirements

Before sending an invoice to SPV, ensure:

1. **Invoice Type**: Must be a fiscal invoice (not proforma)
2. **Invoice Status**: Must be finalized (not draft) and not voided
3. **OAuth Authentication**: Valid ANAF OAuth token for the target environment
4. **Client Data**: Complete client information including:
   - Name and address
   - CUI/CIF for B2B clients
   - Valid Romanian fiscal data

## Validation Checks

The API performs comprehensive validation before submission:

| Check | Requirement | Error Code |
|-------|-------------|------------|
| Invoice Type | Must be fiscal | `not_fiscal_invoice` |
| Draft Status | Cannot be draft | `invoice_is_draft` |
| Voided Status | Cannot be voided | `invoice_is_voided` |
| Already Sent | Not already submitted | `already_sent_to_spv` |
| OAuth Token | Valid and not expired | `oauth_not_configured` |
| Client Data | Complete and valid | `invalid_client_data` |

## Response

<ResponseField name="success" type="boolean">
  Indicates if the request was successful
</ResponseField>

<ResponseField name="data" type="object">
  Submission details
  
  <Expandable title="Response Object">
    <ResponseField name="object" type="string">
      Always `efactura_submission`
    </ResponseField>
    
    <ResponseField name="success" type="boolean">
      Whether the submission was successful
    </ResponseField>
    
    <ResponseField name="invoice_id" type="string">
      The invoice ID
    </ResponseField>
    
    <ResponseField name="invoice_number" type="string">
      The invoice number
    </ResponseField>
    
    <ResponseField name="status" type="string">
      Submission status (usually `submitted`)
    </ResponseField>
    
    <ResponseField name="environment" type="string">
      The environment used (`test` or `live`)
    </ResponseField>
    
    <ResponseField name="message" type="string">
      Success or error message
    </ResponseField>
    
    <ResponseField name="submission" type="object">
      Submission details
      
      <Expandable title="Submission Details">
        <ResponseField name="id" type="integer">
          Internal submission ID
        </ResponseField>
        
        <ResponseField name="upload_id" type="string">
          ANAF upload index/ID
        </ResponseField>
        
        <ResponseField name="submitted_at" type="string">
          ISO 8601 timestamp of submission
        </ResponseField>
      </Expandable>
    </ResponseField>
  </Expandable>
</ResponseField>

## SPV Processing Flow

```mermaid
graph LR
    A[Invoice] --> B[Validate]
    B --> C[Generate XML]
    C --> D[Submit to ANAF]
    D --> E[Submitted Status]
    E --> F[ANAF Processing]
    F --> G[Accepted/Rejected]
```

After submission:
1. Invoice status changes to `submitted`
2. ANAF processes the invoice (usually within minutes)
3. Check status via the retrieve invoice endpoint
4. Final status will be `accepted` or `rejected`

<RequestExample>

```bash cURL - Test Environment
curl -X POST https://api.contazen.ro/v1/invoices/inv_9z8y7x6w5v/send-to-spv?environment=test \
  -H "Authorization: Bearer sk_live_YOUR_API_KEY"
```

```bash cURL - Production
curl -X POST https://api.contazen.ro/v1/invoices/inv_9z8y7x6w5v/send-to-spv?environment=live \
  -H "Authorization: Bearer sk_live_YOUR_API_KEY"
```

```javascript Node.js
const response = await fetch('https://api.contazen.ro/v1/invoices/inv_9z8y7x6w5v/send-to-spv?environment=test', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer sk_live_YOUR_API_KEY'
  }
});

const data = await response.json();
```

```python Python
import requests

response = requests.post(
    'https://api.contazen.ro/v1/invoices/inv_9z8y7x6w5v/send-to-spv',
    params={'environment': 'test'},
    headers={'Authorization': 'Bearer sk_live_YOUR_API_KEY'}
)

data = response.json()
```

```php PHP
$ch = curl_init('https://api.contazen.ro/v1/invoices/inv_9z8y7x6w5v/send-to-spv?environment=test');
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'POST');
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'Authorization: Bearer sk_live_YOUR_API_KEY'
]);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
$data = json_decode($response, true);
```

</RequestExample>

<ResponseExample>

```json Success Response
{
  "success": true,
  "data": {
    "object": "efactura_submission",
    "success": true,
    "invoice_id": "inv_9z8y7x6w5v",
    "invoice_number": "CTZ-2024-00123",
    "status": "submitted",
    "environment": "test",
    "message": "Invoice successfully submitted to SPV for processing",
    "submission": {
      "id": 456,
      "upload_id": "5090000456",
      "submitted_at": "2024-03-20T14:30:00Z"
    }
  },
  "meta": {
    "version": "v1",
    "response_time": "2345.67ms"
  }
}
```

```json Error - OAuth Not Configured
{
  "success": false,
  "error": {
    "message": "ANAF OAuth authentication required. Please configure OAuth for test environment first.",
    "type": "authentication_error",
    "code": "oauth_not_configured",
    "environment": "test",
    "oauth_url": "https://app.contazen.ro/firm/efactura/",
    "status": 401
  },
  "meta": {
    "version": "v1",
    "response_time": "23.45ms"
  }
}
```

```json Error - Invalid Client Data
{
  "success": false,
  "error": {
    "message": "SPV submission failed: Client CUI is required for B2B invoices",
    "type": "validation_error",
    "code": "invalid_client_data",
    "environment": "test",
    "status": 400
  },
  "meta": {
    "version": "v1",
    "response_time": "34.56ms"
  }
}
```

```json Error - Already Submitted
{
  "success": false,
  "error": {
    "message": "Invoice has already been sent to SPV. Current status: processing",
    "type": "invalid_request_error",
    "code": "already_sent_to_spv",
    "current_status": "processing",
    "status": 400
  },
  "meta": {
    "version": "v1",
    "response_time": "12.34ms"
  }
}
```

```json Error - Not Fiscal Invoice
{
  "success": false,
  "error": {
    "message": "Only fiscal invoices can be sent to SPV. This is a proforma invoice.",
    "type": "invalid_request_error",
    "code": "not_fiscal_invoice",
    "invoice_type": "proforma",
    "status": 400
  },
  "meta": {
    "version": "v1",
    "response_time": "11.22ms"
  }
}
```

</ResponseExample>

## OAuth Configuration

Before using this endpoint, configure ANAF OAuth:

1. **Access e-Factura Settings** in your Contazen account
2. **Choose Environment**: Select test or live
3. **Authenticate with ANAF**: Complete OAuth flow
4. **Token Validity**: Tokens expire after 60 days

<Warning>
  **Production Environment**: Only use `environment=live` for real invoices. Test environment submissions are not legally valid.
</Warning>

## Common Issues

### Missing CUI/CIF
For B2B invoices, ensure the client has a valid Romanian CUI/CIF:
```javascript
// Correct B2B client data
{
  "name": "Example Company SRL",
  "cui": "RO12345678",  // Required for companies
  "address": "Str. Example 123",
  "city": "București"
}
```

### Token Expiration
OAuth tokens expire after 60 days. Check token status:
```bash
GET /api/v1/settings
# Check efactura.oauth_expires_at field
```

### Environment Mismatch
Ensure you're using the correct environment:
- **Test**: For development and testing
- **Live**: For real, legally-binding invoices

## Webhook Events

After submission, monitor invoice status changes via webhooks or polling:

| Status | Meaning | Next Action |
|--------|---------|-------------|
| `submitted` | Sent to ANAF | Wait for processing |
| `processing` | ANAF is validating | Continue waiting |
| `accepted` | Successfully processed | Download from ANAF |
| `rejected` | Failed validation | Check errors and resubmit |

## Related Endpoints

- [Create Invoice](/api-reference/endpoints/invoices/create) - Create invoices with e-Factura data
- [Retrieve Invoice](/api-reference/endpoints/invoices/retrieve) - Check submission status
- [Settings](/api-reference/endpoints/settings/get) - View OAuth status and configuration
- [E-Factura Integration](/examples/e-factura-integration) - Complete integration guide